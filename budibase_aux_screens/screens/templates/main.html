{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Lobster&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <title>Tela Principal</title>
</head>
<body>
    <div class="Corpo">
        <label for="myfile">Selecione um arquivo:</label>
        <form id="uploadForm" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="file" id="myfile" name="myfile" multiple>
            <button id="showCarouselButton" type="button" class="uploadButton">Visualizar Carrossel</button>
            <button id="uploadButton" type="submit">Enviar Imagens</button>
        </form>
        <br>

        <!-- div carrossel -->
        <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
            <ol class="carousel-indicators" id="carouselIndicators">
                <!-- Aqui serão adicionados indicadores dinamicamente -->
            </ol>
            <div class="carousel-inner" id="carouselInner">
                <!-- Aqui serão adicionadas as imagens dinamicamente -->
            </div>
            <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Anterior</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Próximo</span>
            </a>
        </div>

    </div>

    <script>
        // Função para carregar as imagens no carrossel
        function loadCarouselImages(files) {
            var carouselIndicators = document.getElementById('carouselIndicators');
            var carouselInner = document.getElementById('carouselInner');

            // Limpar carrossel
            carouselIndicators.innerHTML = '';
            carouselInner.innerHTML = '';

            // Adicionar cada imagem selecionada ao carrossel
            for (var i = 0; i < files.length; i++) {
                var indicator = document.createElement('li');
                indicator.setAttribute('data-target', '#carouselExampleIndicators');
                indicator.setAttribute('data-slide-to', i);
                if (i === 0) {
                    indicator.classList.add('active');
                }
                carouselIndicators.appendChild(indicator);

                var item = document.createElement('div');
                item.classList.add('carousel-item');
                if (i === 0) {
                    item.classList.add('active');
                }
                var img = document.createElement('img');
                img.classList.add('d-block');
                img.classList.add('w-100');
                img.src = URL.createObjectURL(files[i]); // Criar URL para a imagem
                item.appendChild(img);
                carouselInner.appendChild(item);
            }

            // Ativar o carrossel
            $('.carousel').carousel();
        }

        // Event listener para o envio do formulário
        document.getElementById('uploadForm').addEventListener('submit', function(event) {
            // Evitar que o formulário seja enviado automaticamente pelo JavaScript
            event.preventDefault(); 

            // Obter os arquivos selecionados
            var files = document.getElementById('myfile').files;
            
            // Carregar as imagens no carrossel
            loadCarouselImages(files);

            // Enviar o formulário manualmente após a manipulação das imagens
            this.submit();
        });

        // Event listener para o botão de visualizar o carrossel
        document.getElementById('showCarouselButton').addEventListener('click', function(event) {
            // Obter os arquivos selecionados
            var files = document.getElementById('myfile').files;

            // Carregar as imagens no carrossel
            loadCarouselImages(files);
        });
    </script>
</body>
</html>
